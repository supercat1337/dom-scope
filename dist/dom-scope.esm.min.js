var v="data-scope",_="$",y="data-ref";function d(i,t){var e;return t.is_scope_element?e=t.is_scope_element(i,t):e=i.getAttribute(v),e===null?!1:e}function c(i){return Object.assign({},{ref_attr_name:y,document:null,is_scope_element:void 0,default_scope_name:void 0},i)}function E(i,t,e={}){var r={},s={},n=[],o=c(e);function h(l){var f=l.getAttribute(o.ref_attr_name);if(f!=null&&f!=""&&(r[f]?console.warn(`data-ref #${f} is already used`):r[f]=l),l!=i){var u=d(l,o);if(typeof u!="string")return;u!=""?s[u]?(console.warn(`scope #${u} is already used`),n.push(l)):s[u]=l:n.push(l)}t&&t(l)}p(i,h,o);var a=0;return n.forEach(l=>{for(;s[_+a.toString()];)a++;s[_+a.toString()]=l}),{refs:r,scope_refs:s}}function g(i,t){var e={},r=c(t);function s(n){let o=n.getAttribute(r.ref_attr_name);o&&(e[o]=n)}return p(i,s,r),e}function p(i,t,e){var r=c(e);function s(h){var a=h,l=a.parentElement;return l&&l!=i&&d(l,r)!==!1?2:1}let n=(r.document||i.ownerDocument).createTreeWalker(i,1,s);for(var o;o=n.nextNode();)t(o)}var w=class i{#t;#e=!0;#s;#r;options={};constructor(t,e={}){this.#t=t,this.options=e}get root(){return this.#t}get refs(){return this.#e&&this.update(),this.#s}get scopes(){return this.#e&&this.update(),this.#r}update(t){if(this.#t===null)throw new Error("Object is already destroyed");let{refs:e,scope_refs:r}=E(this.#t,t,this.options);this.#s=e;let s={};for(let n in r)s[n]=new i(r[n]),s[n].options=this.options;this.#r=s,this.#e=!1}querySelector(t){if(this.#t===null)throw new Error("Object is already destroyed");let e=this.querySelectorAll(t);return e.length==0?null:e[0]}querySelectorAll(t){if(this.#t===null)throw new Error("Object is already destroyed");var e=this.#t.querySelectorAll(t);if(e.length==0)return[];var r=[];for(let s=0;s<e.length;s++)this.contains(e[s],!0)&&r.push(e[s]);return r}contains(t,e=!1){if(this.#t===null)throw new Error("Object is already destroyed");if(e===!1&&!this.#t.contains(t))return!1;var r=this.scopes;for(let s in r){let n=r[s];if(n.#t==t)return!0;if(n.#t.contains(t))return!1}return!0}walk(t){if(this.#t===null)throw new Error("Object is already destroyed");p(this.#t,t,this.options)}destroy(){this.#t=null,this.#e=!1,this.#s={},this.#r={},this.options={}}isScopeElement(t){let e=c(this.options);return!!d(t,e)}};export{w as DomScope,g as selectRefs,E as selectRefsExtended,p as walkDomScope};
