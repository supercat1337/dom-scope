var T="scope-ref",p="$",_="ref";function w(r,e){var t;return e.is_scope_element?t=e.is_scope_element(r,e):t=r.getAttribute(T),t===null?!1:t}function u(r){let e={ref_attr_name:_,window:globalThis.window,is_scope_element:void 0,include_root:!1},t=Object.assign({},e,r);if(!t.window)throw new Error("settings.window is not defined");return t}function b(r,e,t={}){var i={},s={},o=[],f=u(t);function l(n){var a=n.getAttribute(f.ref_attr_name);if(a!=null&&a!=""&&(i[a]?globalThis.window?console.warn(`Element has reference #${a} which is already used
`,`
element: `,n,`
reference #${a}: `,i[a],`
scope root: `,r):console.warn(`Element has reference #${a} which is already used
`):i[a]=n),n!=r){var c=w(n,f);if(typeof c!="string")return;c!=""?s[c]?(globalThis.window?console.warn(`scope #${c} is already used`,n):console.warn(`scope #${c} is already used`),o.push(n)):s[c]=n:o.push(n)}e&&e(n)}f.include_root===!0&&r instanceof f.window.HTMLElement&&(i.root=r,e&&e(r)),g(r,l,f);var h=0;return o.forEach(n=>{for(;s[p+h.toString()];)h++;s[p+h.toString()]=n}),{refs:i,scope_refs:s}}function $(r,e,t){var i={},s=u(t);function o(f){let l=f.getAttribute(s.ref_attr_name);l&&(e?e[l]&&(i[l]=f):i[l]=f)}return s.include_root===!0&&r instanceof s.window.HTMLElement&&(i.root=r),g(r,o,s),e&&v(i,e),i}function g(r,e,t){var i=u(t);function s(l){var h=l,n=h.parentElement;return n&&n!=r&&w(n,i)!==!1?2:1}let o=i.window.document.createTreeWalker(r,1,s);var f;for(i.include_root===!0&&r instanceof i.window.HTMLElement&&e(r);f=o.nextNode();)e(f)}function v(r,e){for(let t in e){let i=r[t];if(!i)throw new Error(`Missing ref: ${t}`);let s=typeof e[t]=="function"?e[t].prototype:e[t];if(s.isPrototypeOf(i)===!1)throw new Error(`The ref "${t}" must be an instance of ${s.constructor.name} (actual: ${i.constructor.name})`)}}var E=class r{#t=!1;#e;#r=!0;#i;#s;config;constructor(e,t){if(e==null)throw new Error("root_element is null");this.#e=e,this.config=u(t)}get root(){return this.#e}get refs(){return this.#r&&this.update(),this.#i}get scopes(){return this.#r&&this.update(),this.#s}update(e){if(this.#t)throw new Error("Object is already destroyed");let{refs:t,scope_refs:i}=b(this.#e,e,this.config);this.#i=t;let s={};for(let o in i)s[o]=new r(i[o],this.config);this.#s=s,this.#r=!1}querySelector(e){if(this.#t)throw new Error("Object is already destroyed");let t=this.querySelectorAll(e);return t.length==0?null:t[0]}querySelectorAll(e){if(this.#t)throw new Error("Object is already destroyed");var t=this.#e.querySelectorAll(e);if(t.length==0)return[];var i=[];for(let s=0;s<t.length;s++)this.contains(t[s],!0)&&i.push(t[s]);return i}contains(e,t=!1){if(this.#t)throw new Error("Object is already destroyed");if(t===!1&&!this.#e.contains(e))return!1;var i=this.scopes;for(let s in i){let o=i[s];if(o.#e==e)return!0;if(o.#e.contains(e))return!1}return!0}walk(e){if(this.#t)throw new Error("Object is already destroyed");g(this.#e,e,this.config)}destroy(){this.#t=!0,this.#e=null,this.#r=!1,this.#i={},this.#s={},this.config={}}isScopeElement(e){return!!w(e,this.config)}get isDestroyed(){return this.#t}checkRefs(e){if(this.#t)throw new Error("Object is already destroyed");v(this.refs,e)}};function A(r,e){if(typeof r!="string")throw new Error("html must be a string");let t=e?.window||globalThis.window;if(!t)throw new Error("window is not defined");let s=t.document.createElement("template");return s.innerHTML=r,s.content}var y=0,d=new Map;function m(r){if(typeof r=="string"){let t=0;return d.has(r)&&(t=(d.get(r)||0)+1),d.set(r,t),`${r}_${t}`}let e=`id_${y}`;return y++,e}export{E as DomScope,v as checkRefs,A as createFromHTML,m as generateId,$ as selectRefs,b as selectRefsExtended,g as walkDomScope};
