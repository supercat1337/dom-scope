var T="scope-ref",p="$",_="ref";function w(r,e){var t;return e.is_scope_element?t=e.is_scope_element(r,e):t=r.getAttribute(T),t===null?!1:t}function u(r){let e={ref_attr_name:_,window:globalThis.window,is_scope_element:void 0,include_root:!1},t=Object.assign({},e,r);if(!t.window)throw new Error("settings.window is not defined");return t}function b(r,e,t={}){var i={},n={},o=[],f=u(t);function a(s){var l=s.getAttribute(f.ref_attr_name);if(l!=null&&l!=""&&(i[l]?globalThis.window?console.warn(`Element has reference #${l} which is already used
`,`
element: `,s,`
reference #${l}: `,i[l],`
scope root: `,r):console.warn(`Element has reference #${l} which is already used
`):i[l]=s),s!=r){var c=w(s,f);if(typeof c!="string")return;c!=""?n[c]?(globalThis.window?console.warn(`scope #${c} is already used`,s):console.warn(`scope #${c} is already used`),o.push(s)):n[c]=s:o.push(s)}e&&e(s)}f.include_root===!0&&r instanceof f.window.HTMLElement&&(i.root=r,e&&e(r)),g(r,a,f);var h=0;return o.forEach(s=>{for(;n[p+h.toString()];)h++;n[p+h.toString()]=s}),{refs:i,scope_refs:n}}function $(r,e,t){var i={},n=u(t);function o(f){let a=f.getAttribute(n.ref_attr_name);a&&(i[a]=f)}return n.include_root===!0&&r instanceof n.window.HTMLElement&&(i.root=r),g(r,o,n),e&&v(i,e),i}function g(r,e,t){var i=u(t);function n(a){var h=a,s=h.parentElement;return s&&s!=r&&w(s,i)!==!1?2:1}let o=i.window.document.createTreeWalker(r,1,n);var f;for(i.include_root===!0&&r instanceof i.window.HTMLElement&&e(r);f=o.nextNode();)e(f)}function v(r,e){for(let t in e){let i=r[t];if(!i)throw new Error(`Missing ref: ${t}`);let n=typeof e[t]=="function"?e[t].prototype:e[t];if(n.isPrototypeOf(i)===!1)throw new Error(`The ref "${t}" must be an instance of ${n.constructor.name} (actual: ${i.constructor.name})`)}}var E=class r{#t=!1;#e;#r=!0;#i;#n;config;constructor(e,t){if(e==null)throw new Error("root_element is null");this.#e=e,this.config=u(t)}get root(){return this.#e}get refs(){return this.#r&&this.update(),this.#i}get scopes(){return this.#r&&this.update(),this.#n}update(e){if(this.#t)throw new Error("Object is already destroyed");let{refs:t,scope_refs:i}=b(this.#e,e,this.config);this.#i=t;let n={};for(let o in i)n[o]=new r(i[o],this.config);this.#n=n,this.#r=!1}querySelector(e){if(this.#t)throw new Error("Object is already destroyed");let t=this.querySelectorAll(e);return t.length==0?null:t[0]}querySelectorAll(e){if(this.#t)throw new Error("Object is already destroyed");var t=this.#e.querySelectorAll(e);if(t.length==0)return[];var i=[];for(let n=0;n<t.length;n++)this.contains(t[n],!0)&&i.push(t[n]);return i}contains(e,t=!1){if(this.#t)throw new Error("Object is already destroyed");if(t===!1&&!this.#e.contains(e))return!1;var i=this.scopes;for(let n in i){let o=i[n];if(o.#e==e)return!0;if(o.#e.contains(e))return!1}return!0}walk(e){if(this.#t)throw new Error("Object is already destroyed");g(this.#e,e,this.config)}destroy(){this.#t=!0,this.#e=null,this.#r=!1,this.#i={},this.#n={},this.config={}}isScopeElement(e){return!!w(e,this.config)}get isDestroyed(){return this.#t}checkRefs(e){if(this.#t)throw new Error("Object is already destroyed");v(this.refs,e)}};function A(r,e){if(typeof r!="string")throw new Error("html must be a string");let t=e?.window||globalThis.window;if(!t)throw new Error("window is not defined");let n=t.document.createElement("template");return n.innerHTML=r,n.content}var y=0,d=new Map;function m(r){if(typeof r=="string"){let t=0;return d.has(r)&&(t=(d.get(r)||0)+1),d.set(r,t),`${r}_${t}`}let e=`id_${y}`;return y++,e}export{E as DomScope,v as checkRefs,A as createFromHTML,m as generateId,$ as selectRefs,b as selectRefsExtended,g as walkDomScope};
