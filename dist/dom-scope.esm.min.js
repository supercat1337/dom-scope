var _="scope-ref",w="$",v="ref";function d(i,e){var t;return e.is_scope_element?t=e.is_scope_element(i,e):t=i.getAttribute(_),t===null?!1:t}function c(i){let e={ref_attr_name:v,window:globalThis.window,is_scope_element:void 0,default_scope_name:void 0,include_root:!0},t=Object.assign({},e,i);if(!t.window)throw new Error("options.window is not defined");return t}function g(i,e,t={}){var r={},s={},n=[],f=c(t);function a(o){var l=o.getAttribute(f.ref_attr_name);if(l!=null&&l!=""&&(r[l]?console.warn(`Element has reference #${l} which is already used
`,`
element: `,o,`
reference #${l}: `,r[l],`
scope root: `,i):r[l]=o),o!=i){var u=d(o,f);if(typeof u!="string")return;u!=""?s[u]?(console.warn(`scope #${u} is already used`,o),n.push(o)):s[u]=o:n.push(o)}e&&e(o)}f.include_root===!0&&i instanceof t.window.HTMLElement&&(r.root=i,e&&e(i)),p(i,a,f);var h=0;return n.forEach(o=>{for(;s[w+h.toString()];)h++;s[w+h.toString()]=o}),{refs:r,scope_refs:s}}function A(i,e,t){var r={},s=c(t);function n(f){let a=f.getAttribute(s.ref_attr_name);a&&(r[a]=f)}return p(i,n,s),e&&E(r,e),r}function p(i,e,t){var r=c(t);function s(a){var h=a,o=h.parentElement;return o&&o!=i&&d(o,r)!==!1?2:1}let n=r.window.document.createTreeWalker(i,1,s);for(var f;f=n.nextNode();)e(f)}function E(i,e,t){for(let r in e){let s=i[r];if(!s)throw new Error(`Missing ref: ${r}`);let n=e[r].constructor.name==="Function"?e[r].prototype:e[r];if(n.isPrototypeOf(s)===!1)throw new Error(`The ref "${r}" must be an instance of ${n.constructor.name} (actual: ${s.constructor.name})`)}}var y=class i{#t=!1;#e;#r=!0;#s;#i;options;constructor(e,t){if(e==null)throw new Error("root_element is null");this.#e=e,this.options=c(t)}get root(){return this.#e}get refs(){return this.#r&&this.update(),this.#s}get scopes(){return this.#r&&this.update(),this.#i}update(e){if(this.#t)throw new Error("Object is already destroyed");let{refs:t,scope_refs:r}=g(this.#e,e,this.options);this.#s=t;let s={};for(let n in r)s[n]=new i(r[n],this.options);this.#i=s,this.#r=!1}querySelector(e){if(this.#t)throw new Error("Object is already destroyed");let t=this.querySelectorAll(e);return t.length==0?null:t[0]}querySelectorAll(e){if(this.#t)throw new Error("Object is already destroyed");var t=this.#e.querySelectorAll(e);if(t.length==0)return[];var r=[];for(let s=0;s<t.length;s++)this.contains(t[s],!0)&&r.push(t[s]);return r}contains(e,t=!1){if(this.#t)throw new Error("Object is already destroyed");if(t===!1&&!this.#e.contains(e))return!1;var r=this.scopes;for(let s in r){let n=r[s];if(n.#e==e)return!0;if(n.#e.contains(e))return!1}return!0}walk(e){if(this.#t)throw new Error("Object is already destroyed");p(this.#e,e,this.options)}destroy(){this.#t=!0,this.#e=null,this.#r=!1,this.#s={},this.#i={},this.options={}}isScopeElement(e){return!!d(e,this.options)}get isDestroyed(){return this.#t}checkRefs(e){if(this.#t)throw new Error("Object is already destroyed");let t=this.refs;E(t,e,this.options)}};export{y as DomScope,E as checkRefs,A as selectRefs,g as selectRefsExtended,p as walkDomScope};
