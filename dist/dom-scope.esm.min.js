var E="scope-ref",w="$",_="ref";function d(n,e){var t;return e.is_scope_element?t=e.is_scope_element(n,e):t=n.getAttribute(E),t===null?!1:t}function h(n){let e={ref_attr_name:_,window:globalThis.window,is_scope_element:void 0,default_scope_name:void 0,include_root:!0},t=Object.assign({},e,n);if(!t.window)throw new Error("options.window is not defined");return t}function v(n,e,t={}){var r={},s={},i=[],f=h(t);function c(o){var a=o.getAttribute(f.ref_attr_name);if(a!=null&&a!=""&&(r[a]?console.warn(`reference #${a} is already used`):r[a]=o),o!=n){var u=d(o,f);if(typeof u!="string")return;u!=""?s[u]?(console.warn(`scope #${u} is already used`),i.push(o)):s[u]=o:i.push(o)}e&&e(o)}f.include_root===!0&&n instanceof t.window.HTMLElement&&(r.root=n,e&&e(n)),p(n,c,f);var l=0;return i.forEach(o=>{for(;s[w+l.toString()];)l++;s[w+l.toString()]=o}),{refs:r,scope_refs:s}}function g(n,e){var t={},r=h(e);function s(i){let f=i.getAttribute(r.ref_attr_name);f&&(t[f]=i)}return p(n,s,r),t}function p(n,e,t){var r=h(t);function s(c){var l=c,o=l.parentElement;return o&&o!=n&&d(o,r)!==!1?2:1}let i=r.window.document.createTreeWalker(n,1,s);for(var f;f=i.nextNode();)e(f)}var y=class n{#t=!1;#e;#r=!0;#s;#i;options;constructor(e,t){if(e==null)throw new Error("root_element is null");this.#e=e,this.options=h(t)}get root(){return this.#e}get refs(){return this.#r&&this.update(),this.#s}get scopes(){return this.#r&&this.update(),this.#i}update(e){if(this.#t)throw new Error("Object is already destroyed");let{refs:t,scope_refs:r}=v(this.#e,e,this.options);this.#s=t;let s={};for(let i in r)s[i]=new n(r[i],this.options);this.#i=s,this.#r=!1}querySelector(e){if(this.#t)throw new Error("Object is already destroyed");let t=this.querySelectorAll(e);return t.length==0?null:t[0]}querySelectorAll(e){if(this.#t)throw new Error("Object is already destroyed");var t=this.#e.querySelectorAll(e);if(t.length==0)return[];var r=[];for(let s=0;s<t.length;s++)this.contains(t[s],!0)&&r.push(t[s]);return r}contains(e,t=!1){if(this.#t)throw new Error("Object is already destroyed");if(t===!1&&!this.#e.contains(e))return!1;var r=this.scopes;for(let s in r){let i=r[s];if(i.#e==e)return!0;if(i.#e.contains(e))return!1}return!0}walk(e){if(this.#t)throw new Error("Object is already destroyed");p(this.#e,e,this.options)}destroy(){this.#t=!0,this.#e=null,this.#r=!1,this.#s={},this.#i={},this.options={}}isScopeElement(e){return!!d(e,this.options)}get isDestroyed(){return this.#t}checkRefs(e){if(this.#t)throw new Error("Object is already destroyed");let t=this.refs;for(let r in e){let s=e[r],i=t[r];if(!i)throw new Error(`Missing ref: ${r}`);if(s instanceof this.options.window.HTMLElement){if(s.isPrototypeOf(i)===!1)throw new Error(`The ref "${r}" must be an instance of ${s.constructor.name} (actual: ${i.constructor.name})`)}else if(s.prototype.isPrototypeOf(i)===!1)throw new Error(`The ref "${r}" must be an instance of ${s.name} (actual: ${i.constructor.name})`)}}};export{y as DomScope,g as selectRefs,v as selectRefsExtended,p as walkDomScope};
