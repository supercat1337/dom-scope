var y="scope-ref",p="$",v="ref";function w(s,e){var t;return e.is_scope_element?t=e.is_scope_element(s,e):t=s.getAttribute(y),t===null?!1:t}function u(s){let e={ref_attr_name:v,window:globalThis.window,is_scope_element:void 0,include_root:!1},t=Object.assign({},e,s);if(!t.window)throw new Error("settings.window is not defined");return t}function T(s,e,t={}){var r={},i={},o=[],f=u(t);function a(n){var l=n.getAttribute(f.ref_attr_name);if(l!=null&&l!=""&&(r[l]?globalThis.window?console.warn(`Element has reference #${l} which is already used
`,`
element: `,n,`
reference #${l}: `,r[l],`
scope root: `,s):console.warn(`Element has reference #${l} which is already used
`):r[l]=n),n!=s){var c=w(n,f);if(typeof c!="string")return;c!=""?i[c]?(globalThis.window?console.warn(`scope #${c} is already used`,n):console.warn(`scope #${c} is already used`),o.push(n)):i[c]=n:o.push(n)}e&&e(n)}f.include_root===!0&&s instanceof f.window.HTMLElement&&(r.root=s,e&&e(s)),d(s,a,f);var h=0;return o.forEach(n=>{for(;i[p+h.toString()];)h++;i[p+h.toString()]=n}),{refs:r,scope_refs:i}}function _(s,e,t){var r={},i=u(t);function o(f){let a=f.getAttribute(i.ref_attr_name);a&&(r[a]=f)}return i.include_root===!0&&s instanceof i.window.HTMLElement&&(r.root=s),d(s,o,i),e&&E(r,e),r}function d(s,e,t){var r=u(t);function i(a){var h=a,n=h.parentElement;return n&&n!=s&&w(n,r)!==!1?2:1}let o=r.window.document.createTreeWalker(s,1,i);var f;for(r.include_root===!0&&s instanceof r.window.HTMLElement&&e(s);f=o.nextNode();)e(f)}function E(s,e){for(let t in e){let r=s[t];if(!r)throw new Error(`Missing ref: ${t}`);let i=typeof e[t]=="function"?e[t].prototype:e[t];if(i.isPrototypeOf(r)===!1)throw new Error(`The ref "${t}" must be an instance of ${i.constructor.name} (actual: ${r.constructor.name})`)}}var g=class s{#t=!1;#e;#r=!0;#i;#s;config;constructor(e,t){if(e==null)throw new Error("root_element is null");this.#e=e,this.config=u(t)}get root(){return this.#e}get refs(){return this.#r&&this.update(),this.#i}get scopes(){return this.#r&&this.update(),this.#s}update(e){if(this.#t)throw new Error("Object is already destroyed");let{refs:t,scope_refs:r}=T(this.#e,e,this.config);this.#i=t;let i={};for(let o in r)i[o]=new s(r[o],this.config);this.#s=i,this.#r=!1}querySelector(e){if(this.#t)throw new Error("Object is already destroyed");let t=this.querySelectorAll(e);return t.length==0?null:t[0]}querySelectorAll(e){if(this.#t)throw new Error("Object is already destroyed");var t=this.#e.querySelectorAll(e);if(t.length==0)return[];var r=[];for(let i=0;i<t.length;i++)this.contains(t[i],!0)&&r.push(t[i]);return r}contains(e,t=!1){if(this.#t)throw new Error("Object is already destroyed");if(t===!1&&!this.#e.contains(e))return!1;var r=this.scopes;for(let i in r){let o=r[i];if(o.#e==e)return!0;if(o.#e.contains(e))return!1}return!0}walk(e){if(this.#t)throw new Error("Object is already destroyed");d(this.#e,e,this.config)}destroy(){this.#t=!0,this.#e=null,this.#r=!1,this.#i={},this.#s={},this.config={}}isScopeElement(e){return!!w(e,this.config)}get isDestroyed(){return this.#t}checkRefs(e){if(this.#t)throw new Error("Object is already destroyed");E(this.refs,e)}};function b(s,e){if(typeof s!="string")throw new Error("html must be a string");let t=e?.window||globalThis.window;if(!t)throw new Error("window is not defined");let i=t.document.createElement("template");return i.innerHTML=s,i.content}export{g as DomScope,E as checkRefs,b as createFromHTML,_ as selectRefs,T as selectRefsExtended,d as walkDomScope};
