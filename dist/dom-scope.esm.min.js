var v="scope-ref",T="$",A="ref",d={scope_auto_name_prefix:T,scope_ref_attr_name:v,ref_attr_name:A,window:globalThis.window,is_scope_element:void 0,include_root:!1},o={};function m(t,e){var r;return e.is_scope_element?r=e.is_scope_element(t,e):r=t.getAttribute(e.scope_ref_attr_name),r===null?!1:r}function h(t={},e=!0){let r={scope_auto_name_prefix:o.scope_auto_name_prefix||d.scope_auto_name_prefix,scope_ref_attr_name:o.scope_ref_attr_name||d.scope_ref_attr_name,ref_attr_name:o.ref_attr_name||d.ref_attr_name,window:o.window||d.window,is_scope_element:o.is_scope_element||d.is_scope_element,include_root:o.include_root||d.include_root},n=Object.assign({},r,t);if(e&&!n.window)throw new Error("options.window is not defined");return n}function b(t){o={},t.hasOwnProperty("ref_attr_name")&&(o.ref_attr_name=t.ref_attr_name),t.hasOwnProperty("window")&&(o.window=t.window),t.hasOwnProperty("is_scope_element")&&(o.is_scope_element=t.is_scope_element),t.hasOwnProperty("include_root")&&(o.include_root=t.include_root)}function S(t=!0){let e=h({},!1);t?(o.ref_attr_name=/^data-/.test(e.ref_attr_name)?e.ref_attr_name:`data-${e.ref_attr_name}`,o.scope_ref_attr_name=/^data-/.test(e.scope_ref_attr_name)?e.scope_ref_attr_name:`data-${e.scope_ref_attr_name}`):(o.ref_attr_name=e.ref_attr_name.replace(/^data-/,""),o.scope_ref_attr_name=e.scope_ref_attr_name.replace(/^data-/,""))}function $(t,e,r={}){var n={},i={},s=[];let a=h(r);function c(f){var l=f.getAttribute(a.ref_attr_name);if(l!=null&&l!=""&&(n[l]?globalThis.window?console.warn(`Element has reference #${l} which is already used
`,`
element: `,f,`
reference #${l}: `,n[l],`
scope root: `,t):console.warn(`Element has reference #${l} which is already used
`):n[l]=f),f!=t){var u=m(f,a);if(typeof u!="string")return;u!=""?i[u]?(globalThis.window?console.warn(`scope #${u} is already used`,f):console.warn(`scope #${u} is already used`),s.push(f)):i[u]=f:s.push(f)}e&&e(f)}a.include_root===!0&&t instanceof a.window.HTMLElement&&(n.root=t,e&&e(t)),g(t,c,a);var w=0;let _=a.scope_auto_name_prefix;return s.forEach(f=>{for(;i[_+w.toString()];)w++;i[_+w.toString()]=f}),{refs:n,scope_refs:i}}function M(t,e,r){var n={};let i=h(r);function s(a){let c=a.getAttribute(i.ref_attr_name);c&&(e?e[c]&&(n[c]=a):n[c]=a)}return i.include_root===!0&&t instanceof i.window.HTMLElement&&(n.root=t),g(t,s,i),e&&O(n,e),n}function g(t,e,r){let n=h(r);function i(c){var w=c,_=w.parentElement;return _&&_!=t&&m(_,n)!==!1?2:1}let s=n.window.document.createTreeWalker(t,1,i);var a;for(n.include_root===!0&&t instanceof n.window.HTMLElement&&e(t);a=s.nextNode();)e(a)}function O(t,e){for(let r in e){let n=t[r];if(!n)throw new Error(`Missing ref: ${r}`);let i=typeof e[r]=="function"?e[r].prototype:e[r];if(i.isPrototypeOf(n)===!1)throw new Error(`The ref "${r}" must be an instance of ${i.constructor.name} (actual: ${n.constructor.name})`)}}var y=class t{#t=!1;#e;#r=!0;#n;#i;config;constructor(e,r){if(e==null)throw new Error("root_element is null");this.#e=e,this.config=h(r)}get root(){return this.#e}get refs(){return this.#r&&this.update(),this.#n}get scopes(){return this.#r&&this.update(),this.#i}update(e){if(this.#t)throw new Error("Object is already destroyed");let{refs:r,scope_refs:n}=$(this.#e,e,this.config);this.#n=r;let i={};for(let s in n)i[s]=new t(n[s],this.config);this.#i=i,this.#r=!1}querySelector(e){if(this.#t)throw new Error("Object is already destroyed");let r=this.querySelectorAll(e);return r.length==0?null:r[0]}querySelectorAll(e){if(this.#t)throw new Error("Object is already destroyed");var r=this.#e.querySelectorAll(e);if(r.length==0)return[];var n=[];for(let i=0;i<r.length;i++)this.contains(r[i],!0)&&n.push(r[i]);return n}contains(e,r=!1){if(this.#t)throw new Error("Object is already destroyed");if(r===!1&&!this.#e.contains(e))return!1;var n=this.scopes;for(let i in n){let s=n[i];if(s.#e==e)return!0;if(s.#e.contains(e))return!1}return!0}walk(e){if(this.#t)throw new Error("Object is already destroyed");g(this.#e,e,this.config)}destroy(){this.#t=!0,this.#e=null,this.#r=!1,this.#n={},this.#i={},this.config={}}isScopeElement(e){return!!m(e,this.config)}get isDestroyed(){return this.#t}checkRefs(e){if(this.#t)throw new Error("Object is already destroyed");O(this.refs,e)}};function P(t,e){if(typeof t!="string")throw new Error("html must be a string");let s=h(e).window.document.createElement("template");return s.innerHTML=t,s.content}var E=0,p=new Map;function R(t){if(typeof t=="string"){let r=0;return p.has(t)&&(r=(p.get(t)||0)+1),p.set(t,r),`${t}_${r}`}let e=`id_${E}`;return E++,e}export{y as DomScope,O as checkRefs,P as createFromHTML,R as generateId,M as selectRefs,$ as selectRefsExtended,b as setDomScopeOptions,S as useDataAttributes,g as walkDomScope};
