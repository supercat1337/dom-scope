var g="data-scope",R="unnamed-scope",O="data-ref",w=class{ref_attr_name;scope_ref_attr_name;window;isScopeElement;includeRoot;scope_auto_name_prefix;constructor(){this.ref_attr_name=O,this.scope_ref_attr_name=g,this.window=globalThis.window,this.isScopeElement=null,this.includeRoot=!1,this.scope_auto_name_prefix=R}toString(){return`ScopeConfig(ref_attr_name=${this.ref_attr_name}, scope_ref_attr_name=${this.scope_ref_attr_name}, includeRoot=${this.includeRoot}, scope_auto_name_prefix=${this.scope_auto_name_prefix}, window=${this.window?"defined":"undefined"}, isScopeElement=${this.isScopeElement})`}},a=new w;function m(e,t){var r=null;t||(t=a);let n=t.scope_ref_attr_name||g,i=t.isScopeElement;return i?r=i(e,t):r=e.getAttribute(n),r===null?null:r}function P(){return a}function h(e={}){let t=new w;return t.includeRoot=e.hasOwnProperty("includeRoot")&&typeof e.includeRoot<"u"?e.includeRoot:a.includeRoot,t.scope_auto_name_prefix=e.hasOwnProperty("scope_auto_name_prefix")&&typeof e.scope_auto_name_prefix=="string"?e.scope_auto_name_prefix:a.scope_auto_name_prefix,t.isScopeElement=e.hasOwnProperty("isScopeElement")&&typeof e.isScopeElement<"u"?e.isScopeElement:a.isScopeElement,t.ref_attr_name=e.hasOwnProperty("ref_attr_name")&&typeof e.ref_attr_name=="string"?e.ref_attr_name:a.ref_attr_name,t.window=e.hasOwnProperty("window")&&typeof e.window<"u"?e.window:a.window,t.scope_ref_attr_name=e.hasOwnProperty("scope_ref_attr_name")&&typeof e.scope_ref_attr_name=="string"?e.scope_ref_attr_name:a.scope_ref_attr_name,t}function $(e={}){return e.hasOwnProperty("ref_attr_name")&&typeof e.ref_attr_name=="string"&&(a.ref_attr_name=e.ref_attr_name),e.hasOwnProperty("window")&&(a.window=e.window),e.hasOwnProperty("isScopeElement")&&(a.isScopeElement=e.isScopeElement||a.isScopeElement),e.hasOwnProperty("includeRoot")&&typeof e.includeRoot=="boolean"&&(a.includeRoot=e.includeRoot),e.hasOwnProperty("scope_auto_name_prefix")&&typeof e.scope_auto_name_prefix=="string"&&(a.scope_auto_name_prefix=e.scope_auto_name_prefix),e.hasOwnProperty("scope_ref_attr_name")&&typeof e.scope_ref_attr_name=="string"&&(a.scope_ref_attr_name=e.scope_ref_attr_name),a}function T(e,t,r={}){var n={},i={},s=[];let f=h(r);function c(o){var l=o.getAttribute(f.ref_attr_name);if(l!=null&&l!=""&&(n[l]?globalThis.window?console.warn(`Element has reference #${l} which is already used
`,`
element: `,o,`
reference #${l}: `,n[l],`
scope root: `,e):console.warn(`Element has reference #${l} which is already used
`):n[l]=o),o!=e){var d=m(o,f);if(typeof d!="string")return;d!=""?i[d]?(console.warn(`scope #${d} is already used`,globalThis.window?o:""),s.push(o)):i[d]=o:s.push(o)}t&&t(o)}f.includeRoot===!0&&e instanceof f.window.HTMLElement&&(n.root=e,t&&t(e)),y(e,c,f);var u=0;let _=f.scope_auto_name_prefix;return s.forEach(o=>{for(;i[_+u.toString()];)u++;i[_+u.toString()]=o}),{refs:n,scope_refs:i}}function v(e,t,r){var n={};let i=h(r);function s(f){let c=f.getAttribute(i.ref_attr_name);c&&(t?t[c]&&(n[c]=f):n[c]=f)}return i.includeRoot===!0&&e instanceof i.window.HTMLElement&&(n.root=e),y(e,s,i),t&&S(n,t),n}function y(e,t,r){let n=h(r);function i(c){var u=c,_=u.parentElement;return _&&_!=e&&m(_,n)!==null?2:1}let s=n.window.document.createTreeWalker(e,1,i);var f;for(n.includeRoot===!0&&e instanceof n.window.HTMLElement&&t(e);f=s.nextNode();)t(f)}function S(e,t){for(let r in t){let n=e[r];if(!n)throw new Error(`Missing data-ref: ${r}`);let i=typeof t[r]=="function"?t[r].prototype:t[r];if(i.isPrototypeOf(n)===!1)throw new Error(`The data-ref "${r}" must be an instance of ${i.constructor.name} (actual: ${n.constructor.name})`)}}var E=class e{#t=!1;#e;#r=!0;#n={};#i={};config;constructor(t,r){if(t==null)throw new Error("root_element is null");this.#e=t,this.config=h(r)}get root(){return this.#e}get refs(){return this.#r&&this.update(),this.#n}get scopes(){return this.#r&&this.update(),this.#i}update(t){if(this.#t)throw new Error("Object is already destroyed");let{refs:r,scope_refs:n}=T(this.#e,t,this.config);this.#n=r;let i={};for(let s in n)i[s]=new e(n[s],this.config);this.#i=i,this.#r=!1}querySelector(t){if(this.#t)throw new Error("Object is already destroyed");let r=this.querySelectorAll(t);return r.length==0?null:r[0]}querySelectorAll(t){if(this.#t)throw new Error("Object is already destroyed");var r=this.#e.querySelectorAll(t);if(r.length==0)return[];var n=[];for(let i=0;i<r.length;i++)this.contains(r[i],!0)&&n.push(r[i]);return n}contains(t,r=!1){if(this.#t)throw new Error("Object is already destroyed");if(r===!1&&!this.#e.contains(t))return!1;var n=this.scopes;for(let i in n){let s=n[i];if(s.#e==t)return!0;if(s.#e.contains(t))return!1}return!0}walk(t){if(this.#t)throw new Error("Object is already destroyed");y(this.#e,t,this.config)}destroy(){this.#t=!0,this.#e=null,this.#r=!1,this.#n={},this.#i={},this.config={}}isScopeElement(t){return!!m(t,this.config)}get isDestroyed(){return this.#t}checkRefs(t){if(this.#t)throw new Error("Object is already destroyed");S(this.refs,t)}};function x(e,t){if(typeof e!="string")throw new Error("html must be a string");let r=h(t);if(!r.window)throw new Error("window is not defined in options");let s=r.window.document.createElement("template");return s.innerHTML=e,s.content}var p=new Map;function A(e){e||(e=P().scope_auto_name_prefix);let t=0;return p.has(e)&&(t=(p.get(e)||0)+1),p.set(e,t),`${e}-${t}`}export{E as DomScope,S as checkRefs,x as createFromHTML,A as generateId,v as selectRefs,T as selectRefsExtended,$ as setDefaultConfig,y as walkDomScope};
