var y="scope-ref",_="$",E="ref";function d(i,e){var t;return e.is_scope_element?t=e.is_scope_element(i,e):t=i.getAttribute(y),t===null?!1:t}function h(i){return Object.assign({},{ref_attr_name:E,document:null,is_scope_element:void 0,default_scope_name:void 0,include_root:!0},i)}function v(i,e,t={}){var s={},r={},n=[],l=h(t);function c(o){var f=o.getAttribute(l.ref_attr_name);if(f!=null&&f!=""&&(s[f]?console.warn(`reference #${f} is already used`):s[f]=o),o!=i){var u=d(o,l);if(typeof u!="string")return;u!=""?r[u]?(console.warn(`scope #${u} is already used`),n.push(o)):r[u]=o:n.push(o)}e&&e(o)}l.include_root===!0&&(s.root=i,e&&e(i)),p(i,c,l);var a=0;return n.forEach(o=>{for(;r[_+a.toString()];)a++;r[_+a.toString()]=o}),{refs:s,scope_refs:r}}function g(i,e){var t={},s=h(e);function r(n){let l=n.getAttribute(s.ref_attr_name);l&&(t[l]=n)}return p(i,r,s),t}function p(i,e,t){var s=h(t);function r(c){var a=c,o=a.parentElement;return o&&o!=i&&d(o,s)!==!1?2:1}let n=(s.document||i.ownerDocument).createTreeWalker(i,1,r);for(var l;l=n.nextNode();)e(l)}var w=class i{#t=!1;#e;#r=!0;#s;#i;options={};constructor(e,t={}){if(e==null)throw new Error("root_element is null");this.#e=e,this.options=t}get root(){return this.#e}get refs(){return this.#r&&this.update(),this.#s}get scopes(){return this.#r&&this.update(),this.#i}update(e){if(this.#t)throw new Error("Object is already destroyed");let{refs:t,scope_refs:s}=v(this.#e,e,this.options);this.#s=t;let r={};for(let n in s)r[n]=new i(s[n]),r[n].options=this.options;this.#i=r,this.#r=!1}querySelector(e){if(this.#t)throw new Error("Object is already destroyed");let t=this.querySelectorAll(e);return t.length==0?null:t[0]}querySelectorAll(e){if(this.#t)throw new Error("Object is already destroyed");var t=this.#e.querySelectorAll(e);if(t.length==0)return[];var s=[];for(let r=0;r<t.length;r++)this.contains(t[r],!0)&&s.push(t[r]);return s}contains(e,t=!1){if(this.#t)throw new Error("Object is already destroyed");if(t===!1&&!this.#e.contains(e))return!1;var s=this.scopes;for(let r in s){let n=s[r];if(n.#e==e)return!0;if(n.#e.contains(e))return!1}return!0}walk(e){if(this.#t)throw new Error("Object is already destroyed");p(this.#e,e,this.options)}destroy(){this.#t=!0,this.#e=null,this.#r=!1,this.#s={},this.#i={},this.options={}}isScopeElement(e){let t=h(this.options);return!!d(e,t)}get isDestroyed(){return this.#t}};export{w as DomScope,g as selectRefs,v as selectRefsExtended,p as walkDomScope};
